​#nix

** 1. Démarrer un shell.
:PROPERTIES:
:CUSTOM_ID: démarrer-un-shell.
:END:
*** Nixpkgs
:PROPERTIES:
:CUSTOM_ID: nixpkgs
:END:
#+begin_src sh
cd nixpkgs
mkdir lol
cd lol
nix-shell ../ -A kent
#+end_src

*** Paquet local
:PROPERTIES:
:CUSTOM_ID: paquet-local
:END:
Sans flakes

#+begin_src sh
nix-shell -E 'with import <nixpkgs> {}; callPackage ./default.nix {}'
#+end_src

Avec Flakes

#+begin_src sh
nix develop .#my-package
#+end_src

** 2. Débug
:PROPERTIES:
:CUSTOM_ID: débug
:END:
Le plus simple est d'utiliser genericBuild avec les différentes phases,
exemple :

#+begin_src sh
phases="checkPhase installPhase" genericBuild
#+end_src

Liste des phases : unpackPhase patchPhase configurePhase buildPhase
checkPhase installPhase fixupPhase installCheckPhase distPhase Puis

#+begin_src nix
$ export out=~/tmpdev/bc-build/out
$ source $stdenv/setup
$ genericBuild
#+end_src

Pour faire une seule phase

#+begin_src nix
phases="buildPhase checkPhase" genericBuild
#+end_src

NB: on peut faire aussi

#+begin_src nix
[nix-shell]$ eval ${unpackPhase:-unpackPhase}
[nix-shell]$ cd source
[nix-shell]$ eval ${configurePhase:-configurePhase}
[nix-shell]$ eval ${buildPhase:-buildPhase}
#+end_src

** Ressources
:PROPERTIES:
:CUSTOM_ID: ressources
:END:
- [[https://nixos.wiki/wiki/Nixpkgs/Create_and_debug_packages][Source]]
- [[https://nixos.wiki/wiki/Packaging/Tutorial]]
- [[[#nixpkgs][nixpkgs]]]
