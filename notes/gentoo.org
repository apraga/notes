#+title: Gentoo

* Install
=sys-kernel/gentoo-kernel-bin= contient un noyau pré-compilé avec la plupart des choses nécessaires
** Difficulté
Si la clé USB ne démarre pas en UEFI, installer jusqu'à GRUB puis mettre [[https://www.system-rescue.org/][system rescues]] sur la clé USB et inrstaller grub.
* Config
See github repo portag-config
** X
Sans bureau, il faut ajouter pulseaudio dans .xinitrc !

#+begin_src sh
setxkbmap fr bepo
feh --bg-scale ~/pictures/gentoo.jpg &
exec pulseaudio &
exec xmonad

#+end_src

* TBW-108UB
** Version naive
#+begin_src sh
git clone https://github.com/lwfinger/rtl8723bu.git /usr/local
cd /usr/local/rtl8723
# Comment concurrent mode (enable connection + access point by default)
sed '/EXTRA_CFLAGS += -DCONFIG_CONCURRENT_MODE/s/^/#/' Makefile
make
make install
modprobe 8723u
# Enable for future boot
echo 8723bu > /etc/modprobe.d/networking.conf
#+end_src

* Difficultés
** ZFS
Difficulté avec pool partagée avec Freebsd.
1. data n'est pas montée proprement
    Cela est du à zfs-import-cache
    #+begin_src  sh
    systemctl status zfs-import-cache
    #+end_src
    Il trouve que /etc/zpool/cache n'est pas vide. En resettant le cache, cela semble marcher
    #+begin_src sh
zpool export data
zpool import data
zpool set cachefile=none data
zpool set cachefile=/etc/zfs/zpool.cache  data
    #+end_src

2. zroot devrait être montée dans un endroit spécifique
   On ne monte que data
Changer ExecStart dans /lib/systemd/system/zfs-mount.service pour monter seulement data
#+begin_src sh
ExecStart=/sbin/zfs mount data
#+end_src
