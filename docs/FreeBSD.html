<!DOCTYPE html>
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<title>FreeBSD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<div id="Accéder à un dossier partagé depuis Windows"><h1 id="Accéder à un dossier partagé depuis Windows" class="header"><a href="#Accéder à un dossier partagé depuis Windows">Accéder à un dossier partagé depuis Windows</a></h1></div>

<p>
Impossible d'utiliser mount<sub>smbfs</sub> mais smbclient //DESKTOP-G1M6J9S/test
</p>

<p>
Pour envoyer des fichiers : smbclient //DESKTOP-G1M6J9S/test -c &amp;quot;prompt off; mput *&amp;quot;
</p>

<p>
<span class="todo">TODO</span>: comment envoyer un dossier complet ??
</p>

<p>
On récupérer le nom du server (netbios) avec nbtscan IP
</p>

<div id="Scrub zfs"><h1 id="Scrub zfs" class="header"><a href="#Scrub zfs">Scrub zfs</a></h1></div>

<p>
Dans /etc/defaults/periodic, le faire tous les 35 jours avec:
</p>

<p>
&lt;pre&gt;daily_scrub_zfs_enable=&amp;quot;NO&amp;quot;
daily_scrub_zfs_pools=&amp;quot;&amp;quot;            # empty string selects all pools
daily_scrub_zfs_default_threshold=&amp;quot;35&amp;quot;&lt;/pre&gt;
</p>
<div id="Emacs nativecomp"><h1 id="Emacs nativecomp" class="header"><a href="#Emacs nativecomp">Emacs nativecomp</a></h1></div>

<p>
Installer texinfo Editer le makefile de lang/gcc10: Ajouter &amp;quot;.jit&amp;quot; : LANGUAGES:= c,c++,objc,fortran,jit Ajouter –enable-host-shared à CONFIGURE<sub>ARGS</sub> Puis make install Copier à la main libgccjit.h sudo cp work/gcc-10.2.0/gcc/jit/libgccjit.h ''usr/local/include''
</p>

<p>
Compiler emacs git clone <a href="git://git.savannah.gnu.org/emacs.git">git://git.savannah.gnu.org/emacs.git</a> -b feature/native-comp cd emacs ./autogen.sh
</p>

<p>
CC=gcc10 ./configure –with-native-compilation –with-x-toolkit=lucid make -j$(nproc) make install
</p>

<p>
Enfin, éviter la mise à jour de GCC10 avec pkg lock gcc10
</p>

<div id="Mise à jour -CURRENT sur rasbperry pi 4"><h1 id="Mise à jour -CURRENT sur rasbperry pi 4" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4">Mise à jour -CURRENT sur rasbperry pi 4</a></h1></div>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-From advice on discord #embedded)"><h2 id="From advice on discord #embedded)" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-From advice on discord #embedded)">From advice on discord #embedded)</a></h2></div>

<p>
The first time: i use git pull –ff-only in /usr/src then the ususl make buildworld &amp;amp; friends To set up src, in /usr do git clone <a href="https://git/freebsd.org/src.git">https://git/freebsd.org/src.git</a> cd /usr/src git checkout main
</p>

<p>
subsequently, cd /usr/src &amp;amp;&amp;amp; git pull –ff-only Then make bulidword, buildkernel as in <a href="https://docs.freebsd.org/en/books/handbook/cutting-edge/#makeworld">https://docs.freebsd.org/en/books/handbook/cutting-edge/#makeworld</a>
</p>

<p>
See also: <a href="https://gist.github.com/grahamperrin/e7a266154793d0e039f9a7d52396f8d7#one-off-2021-03-10">https://gist.github.com/grahamperrin/e7a266154793d0e039f9a7d52396f8d7#one-off-2021-03-10</a>
</p>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile"><h2 id="HOLD Trying to cross compile" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile">HOLD Trying to cross compile</a></h2></div>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-Procedure"><h3 id="Procedure" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-Procedure">Procedure</a></h3></div>

<p>
According to <a href="https://forums.freebsd.org/threads/trying-to-perform-a-cross-compile-to-upgrade-in-a-raspberry-4-b.77430/">https://forums.freebsd.org/threads/trying-to-perform-a-cross-compile-to-upgrade-in-a-raspberry-4-b.77430/</a>
</p>

<p>
Pour accéder au pi en local, sshfs: sudo pkg install fusefs-sshfs kldload fusefs doas -u root sysctl vfs.usermount=1 Pour plus tard :
</p>

<ul>
<li>
mettre fuse<sub>load</sub>=&amp;quot;YES&amp;quot; dans /boot/loader.conf

<li>
mettre vfs.usermount=1 dans /etc/sysctl.conf

</ul>

<p>
sshfs -o idmap=user -p 666 alex@192.168.1.78: /raspberry
</p>

<p>
Récupérer src cd ~/softwares/raspberry-update/ git clone -o freebsd -b main <a href="https://git.freebsd.org/src.git">https://git.freebsd.org/src.git</a> src
</p>

<p>
Preparation mkdir obj setenv MAKEOBJDIRPREFIX ~/softwares/raspberry-update/obj/
</p>

<p>
Build world: cd src/ time make -j 4 TARGET=arm64 TARGET<sub>ARCH</sub>=aarch64 buildworld =&amp;gt; 2h30 time make -j 4 TARGET=arm64 TARGET<sub>ARCH</sub>=aarch64 buildkernel KERNCONF=GENERIC-NODEBUG =&amp;gt; 10min (!)
</p>

<p>
On a besoin de lancer les commandes comme root donc on authorise le root login dans /etc/ssh/sshd<sub>config</sub> et on re-mount sudo umount ''raspberry sshfs -o idmap=user -p 666 root@192.168.1.78:'' ''raspberry Le &amp;quot;''&amp;quot; est important, sinon on va installer dans /root … On fait une sauvegarde du kernel avant !!! ssh raspberry sudo cp /book/kernel /book/kernel.save
</p>

<p>
Go: make TARGET<sub>ARCH</sub>=aarch64 DESTDIR=/raspberry/ KERNCONF=GENERIC-NODEBUG installkernel
</p>

<p>
On redémarre et On croise les doigts
</p>

<p>
Avant:
</p>

<p>
&lt;pre&gt;uname -a
FreeBSD generic 14.0-CURRENT FreeBSD 14.0-CURRENT #0 main-n245255-483c6da3a20: Thu Mar  4 08:04:51 UTC 2021     root@releng1.nyi.freebsd.org:/usr/obj/usr/src/arm64.aarch64/sys/GENERIC  arm64&lt;/pre&gt;
</p>
<div id="Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-KILL Latest 1663120ae452fe3783c74ce40522caf0e2327608 fails"><h3 id="KILL Latest 1663120ae452fe3783c74ce40522caf0e2327608 fails" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-KILL Latest 1663120ae452fe3783c74ce40522caf0e2327608 fails">KILL Latest 1663120ae452fe3783c74ce40522caf0e2327608 fails</a></h3></div>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-KILL Version actuelle sans debug 483c6da3a20"><h3 id="KILL Version actuelle sans debug 483c6da3a20" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-KILL Version actuelle sans debug 483c6da3a20">KILL Version actuelle sans debug 483c6da3a20</a></h3></div>

<p>
(avec les optimisations de &lt;span class="spurious-link" target="Utiliser la config de f451"&gt;''Utiliser la config de f451''&lt;/span&gt;
</p>

<p>
&lt;syntaxhighlight lang="shell"&gt;git clone -o freebsd -b main <a href="https://git.freebsd.org/src.git">https://git.freebsd.org/src.git</a> src
git checkout -b 483c6da3a20
mkdir obj
setenv MAKEOBJDIRPREFIX ~/softwares/raspberry-update/obj/
time make -j 4 TARGET=arm64 TARGET_ARCH=aarch64 buildkernel KERNCONF=GENERIC-NODEBUG&lt;/syntaxhighlight&gt;
=&amp;gt; 10min
</p>

<p>
&lt;syntaxhighlight lang="shell"&gt;sshfs -o idmap=user -p 666 root@192.168.1.78:/ /raspberry&lt;/syntaxhighlight&gt;
On backup /book/kernel avant puis
</p>

<p>
&lt;syntaxhighlight lang="shell"&gt;make TARGET_ARCH=aarch64 DESTDIR=/raspberry/ KERNCONF=GENERIC-NODEBUG  installkernel&lt;/syntaxhighlight&gt;
</p>
<div id="Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Causes d'echec :"><h3 id="&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Causes d'echec :" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-HOLD Trying to cross compile-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Causes d'echec :">&lt;span class="todo <span class="todo">TODO</span>"&gt;<span class="todo">TODO</span>&lt;/span&gt; Causes d'echec :</a></h3></div>

<ul>
<li>
Impossible de faire buildkernel sans buildworld ?

</ul>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Faire son propre serveur freebsd-update ??server"><h2 id="&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Faire son propre serveur freebsd-update ??server" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Faire son propre serveur freebsd-update ??server">&lt;span class="todo <span class="todo">TODO</span>"&gt;<span class="todo">TODO</span>&lt;/span&gt; Faire son propre serveur freebsd-update ??server</a></h2></div>

<p>
Voir si c'est possible <a href="https://docs.freebsd.org/en/articles/freebsd-update-server/">https://docs.freebsd.org/en/articles/freebsd-update-server/</a>
</p>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi"><h2 id="&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi">&lt;span class="todo <span class="todo">TODO</span>"&gt;<span class="todo">TODO</span>&lt;/span&gt; Compilation sur le pi</a></h2></div>

<p>
Selon les conseils de f451 sur discord (4-5 h de compilation au total)
</p>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Utiliser un disque en usb3 plutôt que le cache =&amp;gt; y mettre /usr/src et /usr/obj"><h3 id="&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Utiliser un disque en usb3 plutôt que le cache =&amp;gt; y mettre /usr/src et /usr/obj" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Utiliser un disque en usb3 plutôt que le cache =&amp;gt; y mettre /usr/src et /usr/obj">&lt;span class="todo <span class="todo">TODO</span>"&gt;<span class="todo">TODO</span>&lt;/span&gt; Utiliser un disque en usb3 plutôt que le cache =&amp;gt; y mettre /usr/src et /usr/obj</a></h3></div>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-Workflow de f451"><h3 id="Workflow de f451" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-Workflow de f451">Workflow de f451</a></h3></div>

<p>
make -j10 cleanworld &amp;amp;&amp;amp; make -j10 cleandir &amp;amp;&amp;amp; make -j10 clean &amp;amp;&amp;amp; make -j6 buildworld &amp;amp;&amp;amp; make -j6 buildkernel &amp;amp;&amp;amp; make installkernel &amp;amp;&amp;amp; make installworld &amp;amp;&amp;amp; mergemaster -Ui (merge all the changes) then make check-old yes | make delete-old yes | make delete-old-libs reboot
</p>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;done DONE&quot;&gt;DONE&lt;/span&gt; Utiliser la config de f451"><h3 id="&lt;span class=&quot;done DONE&quot;&gt;DONE&lt;/span&gt; Utiliser la config de f451" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;done DONE&quot;&gt;DONE&lt;/span&gt; Utiliser la config de f451">&lt;span class="done <span class="todo">DONE</span>"&gt;<span class="todo">DONE</span>&lt;/span&gt; Utiliser la config de f451</a></h3></div>

<p>
&lt;ol style="list-style-type: decimal;"&gt;
&lt;li&gt;&lt;p&gt;&lt;span class="done <span class="todo">DONE</span>"&gt;<span class="todo">DONE</span>&lt;/span&gt; /etc/src.conf&lt;/p&gt;
&lt;p&gt;<a href="https://user.fm/files/v2-68d74fd0b799cc134536c72c766466bd/etc.src.conf.txt&lt;/p&gt;">https://user.fm/files/v2-68d74fd0b799cc134536c72c766466bd/etc.src.conf.txt&lt;/p&gt;</a>
&lt;pre&gt;KERNCONF=[redacted]
WITHOUT_DEBUG_FILES=
WITH_CCACHE_BUILD=
WITH_OPENSSL_KTLS=
</p>

<p>
WITHOUT_APM=
WITHOUT_ASSERT_DEBUG=
WITHOUT_BLUETOOTH=
WITHOUT_CUSE=
WITHOUT_DICT=
WITHOUT_DMAGENT=
WITHOUT_FLOPPY=
WITHOUT_FREEBSD_UPDATE=
WITHOUT_HAST=
WITHOUT_IPFILTER=
WITHOUT_IPFW=
WITHOUT_ISCSI=
WITHOUT_KERNEL_SYMBOLS=
WITHOUT_LLVM_TARGET_ALL=
WITH_LLVM_TARGET_AARCH64=
WITH_LLVM_TARGET_ARM=
WITHOUT_LPR=
WITHOUT_NDIS=
WITHOUT_NETGRAPH=
WITHOUT_NIS=
WITHOUT_OFED=
WITHOUT_PORTSNAP=
WITHOUT_PPP=
WITHOUT_RADIUS_SUPPORT=
WITH_RATELIMIT=
WITHOUT_RBOOTD=
WITHOUT_ROUTED=
WITH_SORT_THREADS=
WITH_SVN=
WITHOUT_TALK=
WITHOUT_TESTS=
WITHOUT_TFTP=
WITHOUT_UNBOUND=
#
CFLAGS.clang+= -mcpu=cortex-a72
CXXFLAGS.clang+= -mcpu=cortex-a72
CPPFLAGS.clang+= -mcpu=cortex-a72
ACFLAGS.arm64cpuid.S+= -mcpu=cortex-a72+crypto
ACFLAGS.aesv8-armx.S+= -mcpu=cortex-a72+crypto
ACFLAGS.ghashv8-armx.S+= -mcpu=cortex-a72+crypto&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;KILL /boot/msdos/config.txt (si ventilation !!)&lt;/p&gt;
&lt;p&gt;<a href="https://user.fm/files/v2-a5fdc9db09f97646da0a29e86e7615c2/config.txt&lt;/p&gt;">https://user.fm/files/v2-a5fdc9db09f97646da0a29e86e7615c2/config.txt&lt;/p&gt;</a>
&lt;pre&gt;arm_control=0x200
dtparam=audio=on,i2c_arm=on,spi=on
dtoverlay=mmc
dtoverlay=pwm
dtoverlay=disable-bt
device_tree_address=0x4000
kernel=u-boot.bin
over_voltage=6
arm_freq=2000
sdram_freq_min=3200&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;span class="done <span class="todo">DONE</span>"&gt;<span class="todo">DONE</span>&lt;/span&gt; /etc/rc.conf&lt;/p&gt;
&lt;p&gt;powerd<sub>enable</sub>=&amp;quot;YES&amp;quot; powerd<sub>flags</sub>=&amp;quot;-r 1&amp;quot;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;span class="done <span class="todo">DONE</span>"&gt;<span class="todo">DONE</span>&lt;/span&gt; /etc/make.conf&lt;/p&gt;
&lt;pre&gt;MAKE_JOBS_NUMBER=6
WITH_CCACHE_BUILD=YES
CCACHE_DIR=/var/cache/ccache
WITH_MANCOMPRESS=YES
OPTIONS_UNSET+=DEBUG
OPTIONS_SET+=OPTIMIZED_CFLAGS
OPTIONS_SET+=DOCS EXAMPLES MANPAGES&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;span class="done <span class="todo">DONE</span>"&gt;<span class="todo">DONE</span>&lt;/span&gt; Changer la taille de /tmp&lt;/p&gt;
&lt;p&gt;En tant que root !! unmount /tmp vi /etc/fstab Mettre 500M au lieu de 50M&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;
</p>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Vérifier refroidessement"><h3 id="&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Vérifier refroidessement" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Vérifier refroidessement">&lt;span class="todo <span class="todo">TODO</span>"&gt;<span class="todo">TODO</span>&lt;/span&gt; Vérifier refroidessement</a></h3></div>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;done DONE&quot;&gt;DONE&lt;/span&gt; Installer ccache-static"><h3 id="&lt;span class=&quot;done DONE&quot;&gt;DONE&lt;/span&gt; Installer ccache-static" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;done DONE&quot;&gt;DONE&lt;/span&gt; Installer ccache-static">&lt;span class="done <span class="todo">DONE</span>"&gt;<span class="todo">DONE</span>&lt;/span&gt; Installer ccache-static</a></h3></div>

<div id="Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; MAJ"><h3 id="&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; MAJ" class="header"><a href="#Mise à jour -CURRENT sur rasbperry pi 4-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Compilation sur le pi-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; MAJ">&lt;span class="todo <span class="todo">TODO</span>"&gt;<span class="todo">TODO</span>&lt;/span&gt; MAJ</a></h3></div>

<p>
Attention, ne pas utiliser -j6 sinon on s'expose à des erreurs &amp;quot;out of swap space&amp;quot;. La bonne commande est:
</p>

<p>
&lt;pre&gt;make -j3 buildworld &amp;amp;&amp;amp; make -j3 buildkernel KERNCONF=GENERIC-NODEBUG&lt;/pre&gt;
Temps de compilation
</p>

<ul>
<li>
buildworld : 10h (2h30 avec 6 threads puis échec + 7.6h)

<li>
buildkernel : 1H

</ul>

<p>
Devrait diminuer pour les prochaines compilations car le kernel sera NODEBUG
</p>

<p>
Echec avec just installkernel
</p>

<p>
On récupéère les dernières sources et on recommence
</p>

<p>
&lt;pre&gt;cd /usr/src &amp;amp;&amp;amp; git pull --ff-only &amp;amp;&amp;amp; make -j10 cleanworld &amp;amp;&amp;amp; make -j10 cleandir &amp;amp;&amp;amp; make -j10 clean
git checkout main
 make -j4 buildkernel KERNCONF=GENERIC-NODEBUG&lt;/pre&gt;
</p>
<div id="Steam"><h1 id="Steam" class="header"><a href="#Steam">Steam</a></h1></div>

<p>
[<a href="https://euroquis.nl//freebsd/2021/04/06/steam-freebsd">https://euroquis.nl//freebsd/2021/04/06/steam-freebsd</a> Instructions]
</p>

<p>
&lt;pre&gt;doas pkg install linux-steam-utils
doas pkg install linux-nvidia-libs&lt;/pre&gt;
Create a steam user, Add it to video and operator group
</p>

<p>
&lt;pre&gt;doas adduser
sysrc linux_enable=yes&lt;/pre&gt;
Dans /etc/fstab
</p>

<p>
&lt;pre&gt;linprocfs /compat/linux/proc     linprocfs rw 0 0
linsysfs  /compat/linux/sys      linsysfs  rw 0 0
tmpfs     /compat/linux/dev/shm  tmpfs     rw 0 0
fdescfs   /dev/fd                fdescfs   rw 0 0
</p>

<p>
doas mount -a
chown steam /compat/linux/dev/shm&lt;/pre&gt;
[<a href="https://github.com/shkhln/linuxulator-steam-utils/wiki/Compatibility">https://github.com/shkhln/linuxulator-steam-utils/wiki/Compatibility</a> Liste des jeux compatibles]
</p>

<div id="Backup"><h1 id="Backup" class="header"><a href="#Backup">Backup</a></h1></div>

<div id="Backup-Rsync pour google drive, mega et hubic :"><h2 id="Rsync pour google drive, mega et hubic :" class="header"><a href="#Backup-Rsync pour google drive, mega et hubic :">Rsync pour google drive, mega et hubic :</a></h2></div>

<p>
En résumé :
</p>

<ol>
<li>
on récupére le pi localement avec rsync (impossible avec duplicity): rtorrent + config

<li>
on encrypte les backup du pi et celles de la config freebsd du desktop avec duplicity

<li>
on fait un symlink pour les upload sur le cloud

<li>
on backup le tout sur google, hubic et mega avec rsync

</ol>

<p>
Code:
</p>

<p>
&lt;pre&gt;#!/usr/local/bin/fish
</p>
<ol>
<li>
3 steps procedure :

<li>
  1. Backup from the pi using rsync

<li>
  2. Encrypt cofig files (rasperry + local) using duplicity

<li>
  2. Backup to the cloud using rsync

</ol>
<p>
#
</p>
<ol>
<li>
Backup data either in clear or encrypted

<li>
- google -&amp;gt; to google drive (clear)

<li>
- hubic -&amp;gt; to Hubic and Mega(clear)

<li>
- local config files -&amp;gt; google and hubic (encrypted)

<li>
- raspberry config files -&amp;gt; google and hubic (encrypted)

<li>
- local rtorrent -&amp;gt; google and hubic (encrypted)

<li>
- raspberry rtorrent -&amp;gt; google and hubic (encrypted)

</ol>
<p>
set root &amp;quot;/home/alex/backups&amp;quot;
</p>

<ol>
<li>
Duplicity needs a passphrase

</ol>
<p>
set -x PASSPHRASE (cat /home/alex/pass.txt)
</p>

<ol>
<li>
#------- Raspberry: backup -----

<li>
Save books

<li>
rclone sync pi:/media/books/ /media/books/

<li>
Save torrents and config files(encrypted)

<li>
Warning : --include implyies everything is excluded so we need /** at the end

<li>
Don't forget the / in the folder too..

</ol>
<p>
set piLocal raspberry-local/
rclone sync --include &amp;quot;/home/alex/Downloads/torrents/**&amp;quot; \
</p>
<blockquote>
--include &amp;quot;/home/alex/Downloads/session/**&amp;quot; \
--include &amp;quot;/usr/local/etc/**&amp;quot;  \
--include &amp;quot;/etc/**&amp;quot;  \
--include &amp;quot;/boot/loader.conf&amp;quot;  pi:/ $piLocal
</blockquote>
<ol>
<li>
Encrypt it

</ol>
<p>
duplicity $piLocal <a href="file:///home/alex/backups/raspberry">file:///home/alex/backups/raspberry</a>
</p>

<p>
#------- Local backup (encrypted) ----------------
</p>
<ol>
<li>
1. Create encrypted local version

</ol>
<p>
#
</p>
<ol>
<li>
This requires setenv PASSPHRASE in doas.conf !!

<li>
Due to permission, we need separate folder for doas command

</ol>
<p>
doas duplicity --include /usr/local/etc/ --include /etc/ \
</p>
<blockquote>
--include /boot/loader.conf --exclude '**' \
/ <a href="file:///home/alex/backups/desktop/root">file:///home/alex/backups/desktop/root</a>
</blockquote>

<p>
duplicity --include /home/alex/Downloads/torrents \
</p>
<blockquote>
--include /home/alex/Downloads/session \
--exclude '**'  \
/home/alex/Downloads <a href="file:///home/alex/backups/desktop/rtorrent">file:///home/alex/backups/desktop/rtorrent</a>
</blockquote>

<p>
#------------ Backup all encnrypted and non encrypted
</p>

<ol>
<li>
Backup is then made with rsync because there is a symlink

<li>
desktop -&amp;gt; google/desktop

<li>
desktop -&amp;gt; hubic /desktop

</ol>
<p>
#--- All
</p>
<ol>
<li>
Google drive and mega can be managed with rclone

</ol>
<p>
rclone -L sync --exclude 'Coopétition/' --drive-import-formats .xlsx $root/google/  google:
rclone -L sync $root/google backblaze:unixStorage
rclone -L sync $root/hubic hubic:
rclone -L sync $root/hubic mega:
</p>

<p>
#--- Passphrase
/usr/local/bin/pass git push&lt;/pre&gt;
</p>
<div id="Maintenir un port"><h1 id="Maintenir un port" class="header"><a href="#Maintenir un port">Maintenir un port</a></h1></div>

<ul>
<li>
Tester avec poudrière

<li>
portlint Makefile

<li>
Faire un PR sur bugzilla

</ul>
<p>
** titre: x11/kitty: Update to XX
** remplir URL du changelog
** cocher “maintainer approval”
</p>

<div id="Maintenir un port-Haskell"><h2 id="Haskell" class="header"><a href="#Maintenir un port-Haskell">Haskell</a></h2></div>

<p>
Incrémenter la version dans le Makefile Générer la liste des dépendences avec: make makesum make cabal-extract cabal-extract-deps make make-use-cabal-revs Mettre à jour le Makefile et lancer les tests avec poudrière
</p>

<div id="Maintenir un port-Python"><h2 id="Python" class="header"><a href="#Maintenir un port-Python">Python</a></h2></div>

<p>
Pour tester avec plusieurs versions de python:
</p>

<p>
echo ‘DEFAULT_VERSIONS+= python=3.6’ &amp;gt; /usr/local/etc/poudriere.d/python36-make.conf poudriere testport -z python36 -j 130Ramd64 -o textproc/py-sphinxext-opengraph
</p>

<p>
Par exemple : 3.6, 3.7, 3.8, 3.9. 3.10
</p>

<div id="Maintenir un port-KILL Freebsd 2020"><h2 id="KILL Freebsd 2020" class="header"><a href="#Maintenir un port-KILL Freebsd 2020">KILL Freebsd 2020</a></h2></div>

<div id="Maintenir un port-KILL Freebsd 2020-Nvidia 950 : "><h3 id="Nvidia 950 : " class="header"><a href="#Maintenir un port-KILL Freebsd 2020-Nvidia 950 : ">Nvidia 950 : </a></h3></div>

<p>
/etc/rc.conf: dbus<sub>enable</sub>=&amp;quot;YES&amp;quot; linux<sub>enable</sub>=&amp;quot;YES&amp;quot; # for nvidia kld<sub>list</sub>=&amp;quot;nvidia-modeset&amp;quot; #nvidia does not work
</p>

<p>
Et faire un xorg.conf dans /usr/local/etc/X11/xorg.conf.d/driver-nvidia.conf Section &amp;quot;Device&amp;quot; Identifier &amp;quot;NVIDIA card&amp;quot; Driver &amp;quot;nvidia&amp;quot; EndSection Source: <a href="https://forums.freebsd.org/threads/howto-setup-xorg-with-nvidias-driver.52311/">https://forums.freebsd.org/threads/howto-setup-xorg-with-nvidias-driver.52311/</a>
</p>

<div id="Maintenir un port-KILL Freebsd 2020-Bepo: télécharger ici"><h3 id="Bepo: télécharger ici" class="header"><a href="#Maintenir un port-KILL Freebsd 2020-Bepo: télécharger ici">Bepo: télécharger ici</a></h3></div>

<p>
<a href="https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=160227">https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=160227</a>
</p>

<p>
Attention, ne pas le mettre dans ''usr/share/syscons/keymaps'' mais ''usr/share/vt/keymaps'' ! Puis dans /etc/rc.conf keymap=&amp;quot;fr-dvorak-bepo&amp;quot;
</p>

<div id="Maintenir un port-KILL Freebsd 2020-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Non résolu : grub avec Zfs on root"><h3 id="&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Non résolu : grub avec Zfs on root" class="header"><a href="#Maintenir un port-KILL Freebsd 2020-&lt;span class=&quot;todo TODO&quot;&gt;TODO&lt;/span&gt; Non résolu : grub avec Zfs on root">&lt;span class="todo <span class="todo">TODO</span>"&gt;<span class="todo">TODO</span>&lt;/span&gt; Non résolu : grub avec Zfs on root</a></h3></div>

<div id="Maintenir un port-KILL Freebsd 2020-Emacs as daemon"><h3 id="Emacs as daemon" class="header"><a href="#Maintenir un port-KILL Freebsd 2020-Emacs as daemon">Emacs as daemon</a></h3></div>

<p>
On peut utiliser rc.d (voir la discussion ici <a href="https://forums.freebsd.org/threads/running-emacs-as-a-daemon.78392/#post-489850)">https://forums.freebsd.org/threads/running-emacs-as-a-daemon.78392/#post-489850)</a> mais cela ralentit le démarrage. Le plus simple est d'utiliser crontab avec @reboot :
</p>

<p>
@reboot /usr/local/bin/emacs –daemon
</p>

<div id="Maintenir un port-KILL Freebsd 2020-Nzbget"><h3 id="Nzbget" class="header"><a href="#Maintenir un port-KILL Freebsd 2020-Nzbget">Nzbget</a></h3></div>

<p>
Fichiers sont dans /usr/local/share/nzbget Éditer le fichier /usr/local/etc/nzbget.conf ( NB root qui s'en occupe pour partager les fichiers avec Linux) Dans /etc/rc.conf: nzbget<sub>enable</sub>=&amp;quot;YES
</p>

<div id="Maintenir un port-KILL Freebsd 2020-Micro USB blue snowball"><h3 id="Micro USB blue snowball" class="header"><a href="#Maintenir un port-KILL Freebsd 2020-Micro USB blue snowball">Micro USB blue snowball</a></h3></div>

<p>
Volume : mixtui + F6 pour choisir le micro + F4 pour volume Discord : ok sous firefox
</p>

<p>
Possible sosu chrome mais avec sndio
</p>

<ol>
<li>
Chercher le numéro avec cat /dev/sndstat

</ol>

<p>
Installed devices: pcm0: &amp;lt;NVIDIA (0x0072) (HDMI/DP 8ch)&amp;gt; (play) pcm1: &amp;lt;NVIDIA (0x0072) (HDMI/DP 8ch)&amp;gt; (play) pcm2: &amp;lt;NVIDIA (0x0072) (HDMI/DP 8ch)&amp;gt; (play) pcm3: &amp;lt;NVIDIA (0x0072) (HDMI/DP 8ch)&amp;gt; (play) pcm4: &amp;lt;Realtek ALC887 (Rear Analog 7.1/2.0)&amp;gt; (play/rec) default pcm5: &amp;lt;Realtek ALC887 (Front Analog)&amp;gt; (play/rec) pcm6: &amp;lt;Realtek ALC887 (Rear Digital)&amp;gt; (play) pcm7: &amp;lt;Realtek ALC887 (Onboard Digital)&amp;gt; (play) pcm8: &amp;lt;USB audio&amp;gt; (rec) No devices installed from userspace
</p>

<ol>
<li>
sndiod -f rsnd/8

<li>
Test micro avec aucat -o test.wav (+ control-c) mplayer test.wav

</ol>

<p>
Attention, semble faire du statique avec la version firefox … Donc non compatible. Si permanent : sndiod<sub>enable</sub> = &amp;quot;YES&amp;quot; sndiod<sub>flags</sub> = &amp;quot;-f rsnd/1 -F rsnd/3&amp;quot;
</p>

<p>
/etc/rc.conf
</p>

<div id="Maintenir un port-KILL Freebsd 2020-Mpd"><h3 id="Mpd" class="header"><a href="#Maintenir un port-KILL Freebsd 2020-Mpd">Mpd</a></h3></div>

<p>
<a href="https://forums.freebsd.org/threads/howto-desktop-musicpd-mpd-configuration.54600/">https://forums.freebsd.org/threads/howto-desktop-musicpd-mpd-configuration.54600/</a> Ajouter au crontab : ''usr/local/bin/musicpd ~''.mpd/musicpd.conf
</p>

<div id="Maintenir un port-KILL Freebsd 2020-Printer HL110"><h3 id="Printer HL110" class="header"><a href="#Maintenir un port-KILL Freebsd 2020-Printer HL110">Printer HL110</a></h3></div>

<p>
Télécharger driver cups et lpd au format .deb <a href="https://support.brother.com/g/b/downloadlist.aspx?c=us_ot&amp;lang=en&amp;prod=hl1110_us_eu_as&amp;os=128">https://support.brother.com/g/b/downloadlist.aspx?c=us_ot&amp;lang=en&amp;prod=hl1110_us_eu_as&amp;os=128</a>
</p>

<p>
Dans cupswrapper et lpr : tar xvzf data.tar.gz -C / Install '''psutils''' and '''linux<sub>base</sub>-c7''': Puis (root) on lance les commande dans postinst (modifiée)
</p>

<p>
&lt;syntaxhighlight lang="shell"&gt; sed -i.bak 's/chown lp/chown root/' /opt/brother/Printers/HL1110/inf/setupPrintcap
 sed -i.bak 's/chgrp lp/chgrp daemon/' /opt/brother/Printers/HL1110/inf/setupPrintcap
/opt/brother/Printers/HL1110/inf/setupPrintcap HL1110 -i USB
/opt/brother/Printers/HL1110/inf/braddprinter -i HL1110
 echo \[psconvert2\]   &gt;&gt;/opt/brother/Printers/HL1110/inf/brHL1110func
 echo pstops=/usr/local/bin/pstops  &gt;&gt; /opt/brother/Printers/HL1110/inf/brHL1110func
 echo \[psconvert2\]   &gt;&gt;/opt/brother/Printers/HL1110/inf/brHL1110func
 ln -s /opt/brother/Printers/HL1110/inf/brHL1110rc       /etc/opt/brother/Printers/HL1110/inf/brHL1110rc
</p>

<ol>
<li>
No need for that

<li>
 echo "#! /bin/sh"  &gt; /usr/local/bin/brprintconflsr3_HL1110

<li>
echo "/opt/brother/Printers/HL1110/lpd/brprintconflsr3 -P HL1110" '$''*'           &gt;&gt;/usr/local/bin/brprintconflsr3_HL1110

<li>
 chmod 755 /usr/local/bin/brprintconflsr3_HL1110

</ol>
<p>
&lt;/syntaxhighlight&gt;
Because it complaints that /usr/local/libexec/cups/filter/brother<sub>ldwrapperHL1110</sub> does not exist :
</p>

<p>
&lt;pre&gt;ln -s /opt/brother/Printers/HL1110/cupswrapper/brother_lpdwrapper_HL1110  /usr/local/libexec/cups/filter&lt;/pre&gt;
</p>
<div id="Taskwarrior server"><h1 id="Taskwarrior server" class="header"><a href="#Taskwarrior server">Taskwarrior server</a></h1></div>

<p>
Avec static ip, probl`eme de certificat
</p>

<p>
500: Client sync key not found - Bitbucket
</p>

</body>
</html>
